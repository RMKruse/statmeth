---
title: "Übungsklausur"
output: 
  html_document: default
  pdf_document: default
---



## Matrikel-Nr.: (Bitte eintragen!) 

## Platz: (Bitte eintragen!)

---

#### Bitte beachten:

-   Alle Lösungen sind IN das Rmarkdown File zu schreiben.

-   Lese genau, wonach gefragt wird und wie die Lösung anzugeben ist.

-   Für jede Aufgabe ist die maximal zu erreichende Punktzahl gegeben.


#### Zugelassene Hilfsmittel:

-   Ein (auch beidseitig) handschriftlich beschriebenes DIN A4-Blatt.

#### Anzahl der anzugebenden Lösungen

  - Gebe niemals mehrere Lösungsalternativen an. Es wird sonst die erste Antwort genommen.

---

## Anzahl der Aufgaben: 3 (in echter Klausur 4)

## Gesamtpunktzahl: ???

---


# Aufgabe 1 (12 Punkte):

Im folgenden werden Aussagen getroffen welche entweder WAHR oder FALSCH sind.
Bewerte jede Aussage, treffe eine Entscheidung ob diese WAHR oder FALSCH ist.
Wenn die Aussage FALSCH ist, bitte begründe warum.

Jede richtig beantwortete Aufgabe gibt 2 Punkte.

*Beispiel:*
Wahr oder Falsch?

Im Model $y_1 = \alpha + \gamma x_1 + \zeta_1$ $y_1$ steht dafür, dass es nur eine Beobachtung gibt. \newline

**Antwort:** Falsch. Die $1$ in dem Modell steht jeweils für die erste Variable $y$. Wir können in SEM Modellen mehrere $y$-Variablen haben.

---

(a) Der Satz von Bayes berechnet die Wahrscheinlichkeit davon, dass zwei Ereignisse $A$ und $B$ gleichzeitig auftreten. (2 Punkte) 

**Antwort:** Falsch. Der Satz von Bayes berechnet bedingte Wahrscheinlichkeiten, also der Wahrscheinlichkeit dass z.B. A eintritt, wenn B bereits eingetreten ist.

(b) Du machst zwei Würfelwürfe (Ereignisse $A$ und $B$). Beim ersten Wurf $A$ sind sechs Augen zu sehen, nun ist die marginale Wahrscheinlichkeit für sechs Augen beim zweiten Wurf $1/36$. (2 Punkte)

**Antwort:** Falsch. Marginale Wahrscheinlichkeiten sind unabhängig von anderen Ergebnissen. Die Marginale Wahrscheinlichkeit für den zweiten Wurf, ist also nur die Wahrscheinlichkeit von von zweiten alleine also $1/6$.

(c) Wahrscheinlichkeiten können nur Werte zwischen $0$ und $1$ annehmen. (2 Punkte)

**Antwort:** Wahr.

(d) Es gibt keine Unterschiede in den Ergebnissen von Kleinst-Quadrate und Maximum-Likelihood Schätzung eines Modells. (2 Punkte)

**Antwort:** Falsch. Die Schätzer der Varianz vom KQ und ML Ansatz unterscheiden sich.

(e) Bei bayesianischen Modellen wollen wir die Posterior Verteilung berechnen. (2 Punkte)

**Antwort:** Wahr. 

(f) Strukturgleichungsmodelle sind speziell, denn sie erlauben es als einziges Modellframework Regression durchzuführen. (2 Punkte)

**Antwort:** Falsch. Auch Lineare Regressionsmodelle oder bayesianische Modelle erlauben ebenfalls eine Regression.

--- 

# Aufgabe 2: Bayesianisches Modell (20 Punkte)

*Setup:*
```{r}
library(brms)
```

(a) 
Lese die gegeben Daten `datensatz1.rda`in R ein. (1 Punkt)

```{r, cache=TRUE}
# Erste Möglichkeit
library(readr)
datensatz1 <- read_csv("datensatz1.csv")

# Zweite Möglichkeit
datensatz1 <- read.csv("datensatz1.csv")
```

*Hinweis:* Wie bei vielem in R gibt es verschiedene Lösungsmöglichkeiten. 


(b)
Schaue dir die zu erklärende Variable `y` an. 
Welche Verteilung folgt diese? 
Was bedeutet es für ein bayesianisches Modell? (2 Punkte)

```{r, cache=TRUE}
summary(datensatz1$y)
hist(datensatz1$y)

```

**Antwort:** Die Variablen `y` scheint einer Normalverteilung zu folgen, auch wenn dies natürlich nicht perfekt aussieht. Aber wir haben ja nur 41 Beobachtungen, also weit weg von "optimalen" Umständen. Es macht Sinn eine Normalverteilung für die "Family" der Daten in einem Bayesianischen Modell zu unterstellen.

(c)
Gegeben der Daten baue ein einfaches bayesianisches Modell, welche die Variablen `x1`, `x2` und einen Intercept nutzt um `y` zu erklären.
Hierbei nimm an, dass du kein eigenes Wissen über die Daten hast. Wie würdest du die Prior auswählen? Begründe deine Entscheidungen. (8 Punkte)

```{r, cache=TRUE}
summary(datensatz1)
# Verteilung der Variablen X1 und X2
par(mfrow=c(1,2)) 
hist(datensatz1$x1); hist(datensatz1$x2)

```



```{r, cache=TRUE}
# Das Modell:
model_c <- brm(y ~ 1 + x1 + x2,
                 data = datensatz1,
                 family = gaussian(),
                 prior = c(
                   prior(normal(675, 150), class = Intercept),
                   prior(normal(0, 150), class = sigma),
                   prior(normal(2.5, 1.8),  class = b, coef = x1),
                   prior(normal(125, 200), class = b, coef = x2)
                 ),
               control = list(adapt_delta = 0.9),    
               save_pars = save_pars(all = TRUE)
            )
summary(model_c)

```

**Antwort:**

  - Intercept: Ist der Schwerpunkt (Mittelwert) der Daten, welcher bei 675 liegt. Die Std. davon stellt einfach unsere Unsicherheit dar.
  - sigma : Ist die Modellstd. welche wir aus den Daten approximieren können über `sd()`, welche bei 150 liegt. Der Mittelwert von sigma liegt per Modell Annahmen immer bei 0. 
  - x1 : Scheint mehr oder minder gleichverteilt zu sein (alternativ könnte man hier auch Mittelwert zentrieren was die Form auch verändert). Unteregrenze liegt bei 0 und obere bei 5.

(d)
Ist das Modell konvergiert? Begründe.

```{r,cache=TRUE}
plot(model_c)
```

**Antwort:** 
Am Plot kann man sehen, dass die Graphen (rechts) übereinander liegen spricht es dafür, dass das Modell "fertig" konvergiert sind.
Alternativ kann man es an der `summary()` erkennen, so wie es am Ende steht mit 
`Rhat is the potential ## scale reduction factor on split chains (at convergence, Rhat = 1).` Also Rhat = 1 es ist konvergiert, was man auch hier erkennen kann.

(e) 
Nach betrachten der Daten behauptet einer deiner Kommilitonen, dass die Variable `x2` keinerlei Einfluss auf `y` haben sollte.
Untersuche ob Variable `x2` ein Platz im Modell haben sollte oder nicht. Begründe. (4 Punkte)

```{r, cache=TRUE}
model_e <- brm(y ~ 1 + x1,
                 data = datensatz1,
                 family = gaussian(),
                 prior = c(
                   prior(normal(675, 150), class = Intercept),
                   prior(normal(0, 150), class = sigma),
                   prior(normal(2.5, 1.8),  class = b, coef = x1)
                 ),
               control = list(adapt_delta = 0.9),    
               save_pars = save_pars(all = TRUE)
            )

```

```{r, cache=TRUE}
# Bayes Faktor
margLogLik_m1 <- bridge_sampler(model_c, silent = TRUE)
margLogLik_m2 <- bridge_sampler(model_e, silent = TRUE)
(BF_ln <- bayes_factor(margLogLik_m1, margLogLik_m2))
WAIC(model_c, model_e)
```



(f)
Interpretiere die Ergebnisse für die Schätzer der Parameter des Modells was du in (d) ausgewählt hast. (3 Punkte)

**Antwort:**

---

# Aufgabe 3: Strukturgleichungsmodelle (Punkte)


(a) 
Lese den Datensatz `datensatz2.csv` ein. 
(1 Punkt)

```{r}

```

(b)

(2 Punkte)

```{r}

```

**Antwort:**

(c)
(8 Punkte)

```{r}

```

**Antwort:**


(d) 
(4 Punkte)

```{r}

```

**Antwort:**
